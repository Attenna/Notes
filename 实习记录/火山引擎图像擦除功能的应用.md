# éœ€æ±‚åˆ†æ
å®¢ä¿¡é€šæœåŠ¡çš„å¾®ä¿¡å°ç¨‹åºéœ€è¦ä¸€ä¸ªaiå›¾åƒå±€éƒ¨é€‰æ‹©ä¿®æ”¹çš„åŠŸèƒ½ã€‚é‚å†™ä¹‹ã€‚
# åŠŸèƒ½å®ç°
ä»£ç æ˜¯aiå†™çš„ã€‚å’Œæœ¬äººå‡ ä¹æ²¡ä»€ä¹ˆå…³ç³»ï¼Œé¢å‘éœ€æ±‚çš„ç¼–ç¨‹äº†å±äºæ˜¯
## SDK
å¾ˆé—æ†¾çš„äº‹æƒ…æ˜¯ï¼Œæˆ‘çš„ç”µè„‘çš„å…¨å±€Pythonç‰ˆæœ¬è¿‡é«˜ï¼Œå±…ç„¶æ²¡æ³•è¿è¡ŒSDKã€‚è€Œä¸”åœ¨è™šæ‹Ÿç¯å¢ƒé‡Œï¼Œå®‰è£…Pythonçš„é€Ÿåº¦æœ‰è¶…çº§æ…¢â€¦â€¦ç»“æœå±…ç„¶ä¸ä½¿ç”¨SDKæ¥å®ç°äº†ã€‚_~~æˆ‘çš„å¤©å“ªaiå¤§äºº~~_
## templates/index.html
### ä»£ç 
```html
<!DOCTYPE html>

<html lang="zh-CN">

<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>æ¶‚æŠ¹æ¶ˆé™¤å·¥å…·</title>
Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  Â  Â  Â  max-width: 1200px;
Â  Â  Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  background-color: #f5f5f5;
Â  Â  Â  Â  }

		Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .upload-section {
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .file-input-wrapper {
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  background-color: #007bff;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .file-input-wrapper:hover {
Â  Â  Â  Â  Â  Â  background-color: #0056b3;
Â  Â  Â  Â  }
Â  Â  Â  Â  #fileInput {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .canvas-container {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  margin: 30px 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .canvas-wrapper {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  canvas {
Â  Â  Â  Â  Â  Â  border: 2px solid #ddd;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  cursor: crosshair;
Â  Â  Â  Â  }
Â  Â  Â  Â  .controls {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  margin: 20px 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  button {
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  margin: 0 10px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-primary {
Â  Â  Â  Â  Â  Â  background-color: #28a745;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-primary:hover {
Â  Â  Â  Â  Â  Â  background-color: #218838;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-secondary {
Â  Â  Â  Â  Â  Â  background-color: #6c757d;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-secondary:hover {
Â  Â  Â  Â  Â  Â  background-color: #545b62;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-danger {
Â  Â  Â  Â  Â  Â  background-color: #dc3545;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-danger:hover {
Â  Â  Â  Â  Â  Â  background-color: #c82333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .brush-size {
Â  Â  Â  Â  Â  Â  margin: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .brush-size input {
Â  Â  Â  Â  Â  Â  width: 100px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .result-section {
Â  Â  Â  Â  Â  Â  margin-top: 30px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  #resultImage {
Â  Â  Â  Â  Â  Â  max-width: 100%;
Â  Â  Â  Â  Â  Â  border: 2px solid #ddd;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .loading {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  color: #007bff;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  margin: 20px 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .error {
Â  Â  Â  Â  Â  Â  color: #dc3545;
Â  Â  Â  Â  Â  Â  margin: 10px 0;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <h1>ğŸ¨ AI æ¶‚æŠ¹æ¶ˆé™¤å·¥å…·</h1>
Â  Â  Â  Â  <div class="upload-section">
Â  Â  Â  Â  Â  Â  <label for="fileInput" class="file-input-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“ é€‰æ‹©å›¾ç‰‡
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  <input type="file" id="fileInput" accept="image/*">
Â  Â  Â  Â  Â  Â  <span id="fileName" style="margin-left: 10px; color: #666;"></span>
Â  Â  Â  Â  </div>
  
Â  Â  Â  Â  <div class="canvas-container">
Â  Â  Â  Â  Â  Â  <div class="canvas-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>åŸå›¾</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="originalCanvas" width="400" height="300"></canvas>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="canvas-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>æ ‡è®°åŒºåŸŸ (ç”¨é¼ æ ‡æ¶‚æŠ¹)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="maskCanvas" width="400" height="300"></canvas>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
  
Â  Â  Â  Â  <div class="controls">
Â  Â  Â  Â  Â  Â  <div class="brush-size">
Â  Â  Â  Â  Â  Â  Â  Â  <label>ç”»ç¬”å¤§å°: </label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="brushSize" min="5" max="50" value="20">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="brushSizeValue">20</span>px
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button class="btn-secondary" onclick="clearMask()">æ¸…é™¤æ ‡è®°</button>
Â  Â  Â  Â  Â  Â  <button class="btn-primary" onclick="processImage()">å¼€å§‹å¤„ç†</button>
Â  Â  Â  Â  </div>
  
Â  Â  Â  Â  <div class="loading" id="loading">
Â  Â  Â  Â  Â  Â  <div>ğŸ”„ æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</div>
Â  Â  Â  Â  </div>
  
Â  Â  Â  Â  <div class="error" id="error"></div>
  
Â  Â  Â  Â  <div class="result-section">
Â  Â  Â  Â  Â  Â  <div id="resultContainer" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>å¤„ç†ç»“æœ</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <img id="resultImage" alt="å¤„ç†ç»“æœ">
Â  Â  Â  Â  Â  Â  Â  Â  <br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-primary" onclick="downloadResult()">ä¸‹è½½ç»“æœ</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
  
Â  Â  <script>
Â  Â  Â  Â  let originalCanvas = document.getElementById('originalCanvas');
Â  Â  Â  Â  let maskCanvas = document.getElementById('maskCanvas');
Â  Â  Â  Â  let originalCtx = originalCanvas.getContext('2d');
Â  Â  Â  Â  let maskCtx = maskCanvas.getContext('2d');
Â  Â  Â  Â  let isDrawing = false;
Â  Â  Â  Â  let currentImage = null;
Â  Â  Â  Â  let brushSize = 20;
  
Â  Â  Â  Â  // æ–‡ä»¶é€‰æ‹©
Â  Â  Â  Â  document.getElementById('fileInput').addEventListener('change', function(e) {
Â  Â  Â  Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  Â  Â  Â  if (file) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('fileName').textContent = file.name;
Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  reader.onload = function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.onload = function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // è°ƒæ•´ç”»å¸ƒå¤§å°
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const maxWidth = 400;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const maxHeight = 300;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let width = img.width;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let height = img.height;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (width > height) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (width > maxWidth) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height = height * (maxWidth / width);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width = maxWidth;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (height > maxHeight) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width = width * (maxHeight / height);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height = maxHeight;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  originalCanvas.width = width;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  originalCanvas.height = height;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maskCanvas.width = width;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maskCanvas.height = height;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ç»˜åˆ¶åŸå›¾
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  originalCtx.drawImage(img, 0, 0, width, height);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // æ¸…é™¤maskç”»å¸ƒ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maskCtx.fillStyle = 'black';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maskCtx.fillRect(0, 0, width, height);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentImage = originalCanvas.toDataURL('image/jpeg');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.src = event.target.result;
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
  
Â  Â  Â  Â  // ç”»ç¬”å¤§å°æ§åˆ¶
Â  Â  Â  Â  document.getElementById('brushSize').addEventListener('input', function(e) {
Â  Â  Â  Â  Â  Â  brushSize = e.target.value;
Â  Â  Â  Â  Â  Â  document.getElementById('brushSizeValue').textContent = brushSize;
Â  Â  Â  Â  });
  
Â  Â  Â  Â  // é¼ æ ‡ç»˜åˆ¶äº‹ä»¶
Â  Â  Â  Â  maskCanvas.addEventListener('mousedown', startDrawing);
Â  Â  Â  Â  maskCanvas.addEventListener('mousemove', draw);
Â  Â  Â  Â  maskCanvas.addEventListener('mouseup', stopDrawing);
Â  Â  Â  Â  maskCanvas.addEventListener('mouseout', stopDrawing);
  
Â  Â  Â  Â  function startDrawing(e) {
Â  Â  Â  Â  Â  Â  isDrawing = true;
Â  Â  Â  Â  Â  Â  draw(e);
Â  Â  Â  Â  }
  
Â  Â  Â  Â  function draw(e) {
Â  Â  Â  Â  Â  Â  if (!isDrawing) return;
Â  Â  Â  Â  Â  Â  const rect = maskCanvas.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  const x = e.clientX - rect.left;
Â  Â  Â  Â  Â  Â  const y = e.clientY - rect.top;
Â  Â  Â  Â  Â  Â  maskCtx.globalCompositeOperation = 'source-over';
Â  Â  Â  Â  Â  Â  maskCtx.fillStyle = 'white';
Â  Â  Â  Â  Â  Â  maskCtx.beginPath();
Â  Â  Â  Â  Â  Â  maskCtx.arc(x, y, brushSize / 2, 0, Math.PI * 2);
Â  Â  Â  Â  Â  Â  maskCtx.fill();
Â  Â  Â  Â  }
  
Â  Â  Â  Â  function stopDrawing() {
Â  Â  Â  Â  Â  Â  isDrawing = false;
Â  Â  Â  Â  }
  
Â  Â  Â  Â  function clearMask() {
Â  Â  Â  Â  Â  Â  maskCtx.fillStyle = 'black';
Â  Â  Â  Â  Â  Â  maskCtx.fillRect(0, 0, maskCanvas.width, maskCanvas.height);
Â  Â  Â  Â  }
  
Â  Â  Â  Â  async function processImage() {
Â  Â  Â  Â  Â  Â  if (!currentImage) {
Â  Â  Â  Â  Â  Â  Â  Â  showError('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const maskData = maskCanvas.toDataURL('image/jpeg');
Â  Â  Â  Â  Â  Â  document.getElementById('loading').style.display = 'block';
Â  Â  Â  Â  Â  Â  document.getElementById('error').textContent = '';
Â  Â  Â  Â  Â  Â  document.getElementById('resultContainer').style.display = 'none';
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/inpaint', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  image: currentImage.split(',')[1], // ç§»é™¤data:image/jpeg;base64,å‰ç¼€
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mask: maskData.split(',')[1]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  if (result.data && result.data.binary_data_base64) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const resultImg = document.getElementById('resultImage');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultImg.src = 'data:image/jpeg;base64,' + result.data.binary_data_base64[0];
Â  Â  Â  Â  Â  Â  Â Â  Â  Â  document.getElementById('resultContainer').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showError('å¤„ç†å¤±è´¥: ' + JSON.stringify(result));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  showError('ç½‘ç»œé”™è¯¯: ' + error.message);
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â   Â  Â  Â  Â  document.getElementById('loading').style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
  
Â  Â  Â  Â  function showError(message) {
Â  Â  Â  Â Â  Â  document.getElementById('error').textContent = message;
Â  Â  Â  Â  }
  
Â  Â  Â  Â  function downloadResult() {
Â  Â  Â  Â  Â  Â  const resultImg = document.getElementById('resultImage');
Â  Â  Â  Â  Â  Â  const link = document.createElement('a');
Â  Â  Â  Â  Â  Â  link.download = 'inpaint_result.jpg';
Â  Â  Â  Â  Â  Â  link.href = resultImg.src;
Â  Â  Â  Â  Â  Â  link.click();
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>
```
### è§£é‡Š
è¿™æ˜¯ç”¨ä½œå‰ç«¯çš„htmlæ–‡ä»¶ã€‚åŒ…æ‹¬äº†é€‰å–å›¾åƒæ–‡ä»¶ï¼Œæ„å»ºç”»å¸ƒç”Ÿæˆmask.pngï¼Œä»¥åŠæŒ‡ç¤ºåç«¯ä¸apié€šä¿¡ï¼Œåç«¯ä¼ å…¥ç»“æœå›¾åƒåï¼Œåˆ™æ˜¾ç°ç»“æœå›¾åƒã€‚
å¥½å§å…¶å®é¡µé¢å¸ƒå±€æ˜¯ä¸é‡è¦çš„ï¼Œä¸»è¦æ˜¯ï¼šå®ƒæ€ä¹ˆå’Œåç«¯äº¤äº’çš„ï¼Ÿ

>ä»¥ä¸‹æ–‡æ®µç”±aiç”Ÿæˆ

è¿™ä¸ªHTMLæ–‡ä»¶é€šè¿‡JavaScriptçš„`fetch` APIä¸åç«¯è¿›è¡Œäº¤äº’ï¼Œä¸»è¦æ˜¯åœ¨ç”¨æˆ·ç‚¹å‡»"å¼€å§‹å¤„ç†"æŒ‰é’®æ—¶ï¼Œå°†å›¾åƒå’Œæ©ç æ•°æ®å‘é€åˆ°åç«¯ï¼Œå¹¶æ¥æ”¶å¤„ç†åçš„ç»“æœã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„äº¤äº’æµç¨‹ï¼š

#### 1. æ•°æ®å‡†å¤‡
å½“ç”¨æˆ·ç‚¹å‡»"å¼€å§‹å¤„ç†"æŒ‰é’®æ—¶ï¼Œä¼šè°ƒç”¨`processImage()`å‡½æ•°ï¼š
- æ£€æŸ¥æ˜¯å¦å·²é€‰æ‹©å›¾ç‰‡ï¼ˆ`currentImage`æ˜¯å¦å­˜åœ¨ï¼‰
- è·å–æ©ç ç”»å¸ƒçš„æ•°æ®ï¼ˆ`maskCanvas.toDataURL('image/jpeg')`ï¼‰
- æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼ˆ`document.getElementById('loading').style.display = 'block'`ï¼‰

#### 2. å‘é€è¯·æ±‚
ä½¿ç”¨`fetch` APIå‘`/inpaint`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼š
```javascript
const response = await fetch('/inpaint', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({
        image: currentImage.split(',')[1], // ç§»é™¤data:image/jpeg;base64,å‰ç¼€
        mask: maskData.split(',')[1]
    })
});
```
- è¯·æ±‚æ–¹æ³•ï¼šPOST
- è¯·æ±‚å¤´ï¼š`Content-Type: application/json`
- è¯·æ±‚ä½“ï¼šåŒ…å«ä¸¤ä¸ªBase64ç¼–ç çš„å­—ç¬¦ä¸²ï¼ˆå»æ‰äº†`data:image/jpeg;base64,`å‰ç¼€ï¼‰ï¼š
  - `image`ï¼šåŸå§‹å›¾ç‰‡çš„Base64æ•°æ®
  - `mask`ï¼šæ©ç å›¾ç‰‡çš„Base64æ•°æ®

#### 3. å¤„ç†å“åº”
ç­‰å¾…åç«¯è¿”å›å“åº”åï¼š
```javascript
const result = await response.json();
if (result.data && result.data.binary_data_base64) {
    const resultImg = document.getElementById('resultImage');
    resultImg.src = 'data:image/jpeg;base64,' + result.data.binary_data_base64[0];
    document.getElementById('resultContainer').style.display = 'block';
} else {
    showError('å¤„ç†å¤±è´¥: ' + JSON.stringify(result));
}
```
- å¦‚æœå“åº”ä¸­åŒ…å«`result.data.binary_data_base64`ï¼Œåˆ™å°†å…¶ä½œä¸ºBase64å›¾ç‰‡æ•°æ®æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
- å¦åˆ™æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

#### 4. é”™è¯¯å¤„ç†
ä½¿ç”¨`try-catch`æ•è·å¯èƒ½çš„ç½‘ç»œé”™è¯¯ï¼š
```javascript
catch (error) {
    showError('ç½‘ç»œé”™è¯¯: ' + error.message);
}
```

#### 5. éšè—åŠ è½½çŠ¶æ€
æ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼Œæœ€åéƒ½ä¼šéšè—åŠ è½½çŠ¶æ€ï¼š
```javascript
finally {
    document.getElementById('loading').style.display = 'none';
}
```

#### å…³é”®ç‚¹
1. **é€šä¿¡æ–¹å¼**ï¼šä½¿ç”¨HTTP POSTè¯·æ±‚ï¼Œæ•°æ®ä»¥JSONæ ¼å¼ä¼ è¾“
2. **æ•°æ®æ ¼å¼**ï¼šå›¾ç‰‡å’Œæ©ç éƒ½è½¬æ¢ä¸ºBase64å­—ç¬¦ä¸²ï¼ˆå»æ‰å‰ç¼€åï¼‰ä¼ è¾“
3. **ç«¯ç‚¹**ï¼š`/inpaint`ï¼Œè¿™æ˜¯åç«¯éœ€è¦æä¾›çš„APIæ¥å£
4. **å“åº”æ ¼å¼**ï¼šåç«¯åº”è¿”å›åŒ…å«`binary_data_base64`å­—æ®µçš„JSONå“åº”

#### åç«¯è¦æ±‚
æ ¹æ®è¿™ä¸ªå‰ç«¯ä»£ç ï¼Œåç«¯éœ€è¦ï¼š
1. æä¾›ä¸€ä¸ª`/inpaint`çš„POSTæ¥å£
2. æ¥æ”¶åŒ…å«`image`å’Œ`mask`çš„Base64æ•°æ®çš„JSONè¯·æ±‚
3. å¤„ç†å›¾åƒï¼ˆå¦‚ä½¿ç”¨AIæ¨¡å‹è¿›è¡Œä¿®å¤ï¼‰
4. è¿”å›åŒ…å«ä¿®å¤åå›¾åƒBase64æ•°æ®çš„JSONå“åº”ï¼Œæ ¼å¼ç±»ä¼¼ï¼š
```json
{
    "data": {
        "binary_data_base64": ["base64å­—ç¬¦ä¸²"]
    }
}
```

è¿™ç§è®¾è®¡ä½¿å¾—å‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯è´Ÿè´£ç”¨æˆ·äº¤äº’å’Œå›¾åƒæ˜¾ç¤ºï¼Œåç«¯è´Ÿè´£å®é™…çš„å›¾åƒå¤„ç†è®¡ç®—ã€‚
## app_fixed.py
### ä»£ç 
```python
# coding:utf-8
from flask import Flask, request, jsonify, render_template
from flask_cors import CORS
import requests
import json
import base64
import hashlib
import hmac
import datetime
import urllib.parse
  
app = Flask(__name__)
CORS(app)

# ç«å±±å¼•æ“é…ç½®
ACCESS_KEY = 'ak'
SECRET_KEY = 'sk'

def generate_volcengine_signature(access_key, secret_key, method, uri, query, headers, payload):
Â  Â  """ç”Ÿæˆç«å±±å¼•æ“API v4ç­¾å - æŒ‰å®˜æ–¹ç¤ºä¾‹ä¿®å¤"""
Â  Â  # æœåŠ¡ä¿¡æ¯
Â  Â  service = 'cv'
Â  Â  region = 'cn-north-1'
Â  Â  algorithm = 'HMAC-SHA256'
Â  Â  host = 'visual.volcengineapi.com'
Â  Â  # æ—¶é—´æˆ³
Â  Â  now = datetime.datetime.now(datetime.timezone.utc)
Â  Â  current_date = now.strftime('%Y%m%dT%H%M%SZ')
Â  Â  datestamp = now.strftime('%Y%m%d')
Â  Â  # payloadçš„SHA256å“ˆå¸Œ
Â  Â  payload_hash = hashlib.sha256(payload.encode('utf-8')).hexdigest()
Â  Â  # æ„å»ºè§„èŒƒè¯·æ±‚
Â  Â  canonical_uri = uri
Â  Â  canonical_querystring = query
Â  Â  signed_headers = 'content-type;host;x-content-sha256;x-date'
Â  Â  content_type = 'application/json'
Â  Â  # è§„èŒƒåŒ–å¤´éƒ¨ - æŒ‰å®˜æ–¹ç¤ºä¾‹æ ¼å¼
Â  Â  canonical_headers = f'content-type:{content_type}\n' + \
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â f'host:{host}\n' + \
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â f'x-content-sha256:{payload_hash}\n' + \
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â f'x-date:{current_date}\n'
Â  Â  # åˆ›å»ºè§„èŒƒè¯·æ±‚
Â  Â  canonical_request = f'{method}\n{canonical_uri}\n{canonical_querystring}\n{canonical_headers}\n{signed_headers}\n{payload_hash}'
Â  Â  print(f"ğŸ” è°ƒè¯•ä¿¡æ¯:")
Â  Â  print(f"canonical_request:\n{canonical_request}")
Â  Â  # åˆ›å»ºå¾…ç­¾åå­—ç¬¦ä¸²
Â  Â  credential_scope = f'{datestamp}/{region}/{service}/request'
Â  Â  string_to_sign = f'{algorithm}\n{current_date}\n{credential_scope}\n{hashlib.sha256(canonical_request.encode("utf-8")).hexdigest()}'
Â  Â  print(f"string_to_sign:\n{string_to_sign}")
Â  Â  # è®¡ç®—ç­¾å - æŒ‰å®˜æ–¹ç¤ºä¾‹
Â  Â  def sign(key, msg):
Â  Â  Â  Â  return hmac.new(key, msg.encode('utf-8'), hashlib.sha256).digest()
Â  Â  def getSignatureKey(key, dateStamp, regionName, serviceName):
Â  Â  Â  Â  kDate = sign(key.encode('utf-8'), dateStamp)
Â  Â  Â  Â  kRegion = sign(kDate, regionName)
Â  Â  Â  Â  kService = sign(kRegion, serviceName)
Â  Â  Â  Â  kSigning = sign(kService, 'request')
Â  Â  Â  Â  return kSigning
Â  Â  signing_key = getSignatureKey(secret_key, datestamp, region, service)
Â  Â  signature = hmac.new(signing_key, string_to_sign.encode('utf-8'), hashlib.sha256).hexdigest()
Â  Â  print(f"signature: {signature}")
Â  Â  # æ„å»ºAuthorizationå¤´
Â  Â  authorization_header = f'{algorithm} Credential={access_key}/{credential_scope}, SignedHeaders={signed_headers}, Signature={signature}'
Â  Â  # æ›´æ–°headers
Â  Â  headers.update({
Â  Â  Â  Â  'X-Date': current_date,
Â  Â  Â  Â  'Authorization': authorization_header,
Â  Â  Â  Â  'X-Content-Sha256': payload_hash,
Â  Â  Â  Â  'Content-Type': content_type
Â  Â  })
Â  Â  return authorization_header, current_date
  
def call_volcengine_api(image_base64, mask_base64):
Â  Â  """è°ƒç”¨ç«å±±å¼•æ“è§†è§‰API"""
Â  Â  try:
Â  Â  Â  Â  # APIå‚æ•° - Actionå’ŒVersionä½œä¸ºæŸ¥è¯¢å‚æ•°
Â  Â  Â  Â  base_url = 'https://visual.volcengineapi.com/'
Â  Â  Â  Â  query_params = {
Â  Â  Â  Â  Â  Â  'Action': 'CVProcess',
Â  Â  Â  Â  Â  Â  'Version': '2022-08-31'
Â  Â  Â  Â  }
Â  Â  Â  Â  # æ„å»ºå®Œæ•´URL
Â  Â  Â  Â  url = base_url + '?' + urllib.parse.urlencode(query_params)
Â  Â  Â  Â  # è¯·æ±‚ä½“ - åªåŒ…å«ä¸šåŠ¡å‚æ•°
Â  Â  Â  Â  body = {
Â  Â  Â  Â  Â  Â  "req_key": "i2i_inpainting",
Â  Â  Â  Â  Â  Â  "binary_data_base64": [image_base64, mask_base64],
Â  Â  Â  Â  Â  Â  "scale": 7,
Â  Â  Â  Â  Â  Â  "seed": 0,
Â  Â  Â  Â  Â  Â  "steps": 30,
Â  Â  Â  Â  Â  Â  "strength": 0.8
Â  Â  Â  Â  }
Â  Â  Â  Â  payload = json.dumps(body)
Â  Â  Â  Â  # åŸºç¡€è¯·æ±‚å¤´
Â  Â  Â  Â  headers = {
Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  'Host': 'visual.volcengineapi.com'
Â  Â  Â  Â  }
Â  Â  Â  Â  # ç”Ÿæˆç­¾å
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  authorization, current_date = generate_volcengine_signature(
Â  Â  Â  Â  Â  Â  Â  Â  ACCESS_KEY, SECRET_KEY, 'POST', '/', urllib.parse.urlencode(query_params), headers, payload
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  print(f"ğŸš€ è°ƒç”¨ç«å±±å¼•æ“API...")
Â  Â  Â  Â  Â  Â  print(f"ğŸ“ å®Œæ•´URL: {url}")
Â  Â  Â  Â  Â  Â  print(f"ğŸ“ è¯·æ±‚ä½“å¤§å°: {len(payload)} å­—èŠ‚")
Â  Â  Â  Â  Â  Â  print(f"ğŸ” ä½¿ç”¨ç­¾åè®¤è¯")
Â  Â  Â  Â  Â  Â  print(f"ğŸ“‹ æœ€ç»ˆè¯·æ±‚å¤´: {headers}")
Â  Â  Â  Â  except Exception as sign_error:
Â  Â  Â  Â  Â  Â  print(f"âš ï¸ Â ç­¾åç”Ÿæˆå¤±è´¥: {sign_error}")
Â  Â  Â  Â  Â  Â  print("ğŸ”„ å°è¯•æ— ç­¾åè¯·æ±‚...")
Â  Â  Â  Â  # å‘é€è¯·æ±‚
Â  Â  Â  Â  response = requests.post(url, headers=headers, data=payload, timeout=60)
Â  Â  Â  Â  print(f"ğŸ“Š å“åº”çŠ¶æ€: {response.status_code}")
Â  Â  Â  Â  print(f"ğŸ“„ å“åº”å¤´: {dict(response.headers)}")
Â  Â  Â  Â  if response.status_code == 200:
Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  result = response.json()
Â  Â  Â  Â  Â  Â  Â  Â  print(f"âœ… APIè°ƒç”¨æˆåŠŸ")
Â  Â  Â  Â  Â  Â  Â  Â  return result
Â  Â  Â  Â  Â  Â  except json.JSONDecodeError:
Â  Â  Â  Â  Â  Â  Â  Â  print(f"âŒ JSONè§£æå¤±è´¥")
Â  Â  Â  Â  Â  Â  Â  Â  return {'error': 'JSONè§£æå¤±è´¥', 'raw_response': response.text}
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  print(f"âŒ APIè°ƒç”¨å¤±è´¥: {response.text}")
Â  Â  Â  Â  Â  Â  return {'error': f'APIè°ƒç”¨å¤±è´¥: {response.status_code}', 'details': response.text}
Â  Â  except Exception as e:
Â  Â  Â  Â  print(f"âŒ è¯·æ±‚å¼‚å¸¸: {str(e)}")
Â  Â  Â  Â  import traceback
Â  Â  Â  Â  traceback.print_exc()
Â  Â  Â  Â  return {'error': f'è¯·æ±‚å¼‚å¸¸: {str(e)}'}
  
@app.route('/')
def index():
Â  Â  return render_template('index.html')
  
@app.route('/inpaint', methods=['POST'])
def inpaint():
Â  Â  try:
Â  Â  Â  Â  data = request.json
Â  Â  Â  Â  img_base64 = data.get('image')
Â  Â  Â  Â  mask_base64 = data.get('mask')
Â  Â  Â  Â  if not img_base64 or not mask_base64:
Â  Â  Â  Â  Â  Â  return jsonify({'error': 'ç¼ºå°‘å›¾ç‰‡æˆ–maskæ•°æ®'}), 400
Â  Â  Â  Â  print(f"ğŸ“¥ æ¥æ”¶åˆ°è¯·æ±‚ï¼Œå›¾ç‰‡å¤§å°: {len(img_base64)} å­—èŠ‚ï¼Œmaskå¤§å°: {len(mask_base64)} å­—èŠ‚")
Â  Â  Â  Â  # è°ƒç”¨ç«å±±å¼•æ“API
Â  Â  Â  Â  result = call_volcengine_api(img_base64, mask_base64)
Â  Â  Â  Â  return jsonify(result)
Â  Â  except Exception as e:
Â  Â  Â  Â  print(f"âŒ å¤„ç†å¼‚å¸¸: {str(e)}")
Â  Â  Â  Â  import traceback
Â  Â  Â  Â  traceback.print_exc()
Â  Â  Â  Â  return jsonify({'error': str(e)}), 500
  
if __name__ == '__main__':
Â  Â  print("ğŸš€ å¯åŠ¨æ¶‚æŠ¹æ¶ˆé™¤æœåŠ¡ï¼ˆä¿®å¤ç­¾åç‰ˆæœ¬ï¼‰...")
Â  Â  print("ğŸ“± è®¿é—®: http://localhost:5000")
Â  Â  print("ğŸ”§ APIæ¥å£: http://localhost:5000/inpaint")
Â  Â  print("ğŸ¯ ä½¿ç”¨ç«å±±å¼•æ“çœŸå®API")
Â  Â  print("=" * 50)
Â  Â  app.run(debug=True, port=5000)
```
### è§£é‡Š

1. è¿™æ˜¯åç«¯é€šä¿¡ç”¨çš„è„šæœ¬ï¼Œä½¿ç”¨`Python Flask`æ¥è¿›è¡Œå‰åç«¯é€šä¿¡ã€‚å¯ç”¨äº†CORSè·¨åŸŸæ”¯æŒ

>Flask æ˜¯ä¸€ä¸ªç”¨ Python ç¼–å†™çš„è½»é‡çº§ Web åº”ç”¨æ¡†æ¶ã€‚

2. è„šæœ¬è¿˜é…ç½®äº†ç«å±±å¼•æ“çš„ACCESS_KEYå’ŒSECRET_KEYï¼Œç”¨äºapiè®¤è¯ï¼Œå­˜å‚¨ä¸ºè„šæœ¬å†…çš„å…¨å±€å˜é‡ã€‚
3. `generate_volcengine_signature`Â å‡½æ•°ï¼š  
    â€ƒâ€ƒ- æŒ‰ç«å±±å®˜æ–¹è¦æ±‚ç”Ÿæˆ API v4 ç­¾åï¼ŒåŒ…æ‹¬è§„èŒƒåŒ–è¯·æ±‚ã€å¤´éƒ¨ã€å“ˆå¸Œã€HMAC è®¡ç®—ç­‰ã€‚  
    â€ƒâ€ƒ- æœ€ç»ˆç”Ÿæˆ Authorization å¤´å¹¶æ›´æ–°è¯·æ±‚ headersã€‚

4. `call_volcengine_api`å‡½æ•°
	å®ƒæ„é€ äº†APIè¯·æ±‚å‚æ•°ï¼ˆå›¾ç‰‡å’Œmaskçš„base64ç¼–ç ï¼‰ï¼Œç”Ÿæˆç­¾åï¼Œå‘é€POSTè¯·æ±‚åˆ°ç«å±±è§†è§‰APIã€‚
	å®ƒå¤„ç†å“åº”ï¼Œè¿”å›ç»“æœæˆ–é”™è¯¯ä¿¡æ¯ã€‚

5. è·¯ç”±Â `/`ï¼šæ¸²æŸ“å‰ç«¯é¡µé¢Â `index.html`ã€‚
6. è·¯ç”±Â `/inpaint`ï¼šæ¥æ”¶å‰ç«¯ POST è¯·æ±‚ï¼Œè·å–å›¾ç‰‡å’Œ maskï¼Œè°ƒç”¨ç«å±± APIï¼Œè¿”å›ä¿®å¤ç»“æœã€‚
7. ä¸»ç¨‹åºå…¥å£ï¼šå¯åŠ¨ Flask æœåŠ¡ï¼Œç›‘å¬ 5000 ç«¯å£ï¼Œå¹¶è¾“å‡ºå¯åŠ¨ä¿¡æ¯ã€‚
#### å¤‡æ³¨
httpsçš„è§„èŒƒåŒ–è¯·æ±‚ï¼Ÿä»€ä¹ˆæ‰æ˜¯ä¸€ä¸ªå¥½çš„httpsï¼ŸhttpsåŒ…æ‹¬äº†

### æ€è€ƒ
æš‚æ— æ€è€ƒ